apiVersion: batch/v1
kind: Job
metadata:
  name: osu-caliper
spec:
  template:
    spec:
      restartPolicy: Never
      containers:
      - name: lammps-worker
        imagePullPolicy: Always
        image: ghcr.io/converged-computing/google-performance-study:osu-caliper-test
        # export CALI_CONFIG_FILE=/caliper-allreduce.conf
        # mpirun --allow-run-as-root -np 8 osu_allreduce
        # export CALI_CONFIG_FILE=/caliper-latency.conf
        # mpirun --allow-run-as-root -np 2 osu_latency
        command: ["/bin/sh", "-c", "sleep infinity"]
        # This is already set
        # workingDir: /root/.local/share/lammps/bench
        env:
        - name: CALI_CONFIG_FILE
          value: /caliper.conf         
        - name: CALI_CONFIG
          value: spot,output=/data/out.cali
      
  backoffLimit: 0
